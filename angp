#!/usr/bin/env bash
version="v0.1"

main() {
	echo "ANGP $version -GPL v3
Usage: angp [OPTION]
try 'angp -h' for more information."
}

angp_help() {
	echo "ANGP(aircrack-ng prompt) $version -GPL v3
Usage: angp [OPTION]

	-h, --help > shows help/info
	start > starts the prompts

Author: Spencer Bravo <spencer@codeshrub.com>"
}

resource_check() {

	resources=("aircrack-ng" "airmon-ng" "airodump-ng")
	for app in "${resources[@]}"; do
		check="$(which $app)"
		if [[ $check == "" ]]; then
			echo $app "is gone";
			$app"_check"="gone"
			install_required="yes";
		fi
	done;	
	if [[ $install_required == "yes" ]]; then
		read -p "Would you like us to try to install these resources for you?([y]/n)" resource_install
		if [[ $resource_install == "y" ]]; then
			git_check="$(which git)"
			if [[ $git_check == "" ]]; then
				read -p "To proceed you must install git, do you want us to install it for you?([y]/n)" git_install
				if [[ $git_install == "y" ]]; then
					sudo apt-get install git
				else
					echo "exiting..."
				fi
			fi
			git clone https://github.com/aircrack-ng/aircrack-ng.git;
			cd aircrack-ng;
			make;
			sudo make install;
		else
			echo "if you want to install the aircrack-ng suite on your own, you can get it from https://github.com/aircrack-ng/aircrack-ng";
		fi
	fi

}

prompt() {

	resource_check
	
	dev_file="/tmp/devices.txt"
	count_file="/tmp/count.txt"

	sudo airmon-ng >> "$dev_file";
	wc -l "$dev_file" >> "$count_file"
	last=$(cat "$count_file" | awk '{print $1}')

	dev=5
	devices=()
	while [[ $dev != $last ]]; do 
		let "num = $dev - 4"
		ind_device=$(cat "$dev_file" | sed -n $dev"p")
		short_dev=$(cat "$dev_file" | sed -n $dev"p" | awk '{print $1}')
		devices=( "${devices[@]}" "$num" )
		echo $num") "$ind_device
		let "dev$num=$short_dev"
		let "dev=$dev + 1"
	done;

	read -p "Type the number that coorisponds to the device you want to use[1]" dev_choice

	let "true_dev= $dev_choice + 4"
	name_dev=$(cat "$dev_file" | sed -n $true_dev"p" | awk '{print $1}')

	sudo airmon-ng start $name_dev >> "/tmp/dev_on.txt"

	rm -rf "/tmp/devices.txt"
	rm -rf "/tmp/count.txt"
	rm -rf "/tmp/dev_on.txt"
	devices=()

}

case "$1" in
	-h|--help)
		angp_help
	;;
	start)
		prompt
	;;
	*)
		main
	;;
esac

