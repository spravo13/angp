#!/usr/bin/env bash
version="v0.4.3"

main() {
	echo "ANGP $version -GPL v3
Usage: angp [OPTION]
try 'angp -h' for more information."
}

angp_help() {
	echo "ANGP(Aircrack-NG Prompt) $version -GPL v3
Usage: angp [OPTION]

	-h, --help > shows help/info
	start > starts the prompts

Author: Spencer Bravo <spencer@codeshrub.com>"
}

resource_check() {

	resources=("aircrack-ng" "airmon-ng" "airodump-ng")
	for app in "${resources[@]}"; do
		#checks whether the app is present on the machine
		check="$(which $app)"
		if [[ $check == "" ]]; then
			#app is not present
			echo $app "is gone";
			$app"_check"="gone"
			install_required="yes";
		fi
	done;	
	if [[ $install_required == "yes" ]]; then
		read -p "Would you like us to try to install these resources for you?([y]/n)" resource_install
		if [[ $resource_install == "y" ]]; then
			#checks to see if git is installed
			git_check="$(which git)"
			if [[ $git_check == "" ]]; then
				read -p "To proceed you must install git, do you want us to install it for you?([y]/n)" git_install
				if [[ $git_install == "y" ]]; then
					sudo apt-get install git
				else
					echo "exiting..."
				fi
			fi
		#	###NOT TESTED###
		#	git clone https://github.com/aircrack-ng/aircrack-ng.git;
		#	cd aircrack-ng;
		#	make;
		#	sudo make install;
		#	################
		else
			echo "if you want to install the aircrack-ng suite on your own, you can get it from https://github.com/aircrack-ng/aircrack-ng";
		fi
	fi

}

prompt() {

	resource_check

	#make sure files that will be used don't already exist
	rm -rf "/tmp/devices.txt"
	rm -rf "/tmp/count.txt"
	rm -rf "/tmp/dev_on.txt"

	#set vars for text files so I don't need to write their names a ton
	#also gives ability to change them with ease
	dev_file="/tmp/devices.txt"
	count_file="/tmp/count.txt"

	sudo airmon-ng >> "$dev_file";
	#counts number of lines in airmon-ng output
	wc -l "$dev_file" >> "$count_file"
	#last declared so it knows when to stop looking at lines(in while loop below)
	last=$(cat "$count_file" | awk '{print $1}')

	#number of lines before first device or airmon-ng
	#set it as first dev and then ++ to go to next dev
	dev=5
	while [[ $dev != $last ]]; do 
		let "num = $dev - 4"
		#individual device for list to choose from
		ind_device=$(cat "$dev_file" | sed -n $dev"p")
		echo $num") "$ind_device
		let "dev=$dev + 1"
	done;

	read -p "Type the number that coorisponds to the device you want to use[1]" dev_choice

	let "true_dev= $dev_choice + 4"
	name_dev=$(cat "$dev_file" | sed -n $true_dev"p" | awk '{print $1}')

	sudo airmon-ng start $name_dev >> "/tmp/dev_on.txt"

	#remove the files used to keep track of things
	rm -rf "/tmp/devices.txt"
	rm -rf "/tmp/count.txt"
	rm -rf "/tmp/dev_on.txt"

}

case "$1" in
	-h|--help)
		angp_help
	;;
	start)
		prompt
	;;
	*)
		main
	;;
esac

